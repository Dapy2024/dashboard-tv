from playwright.sync_api import sync_playwright
import time

def capture(url, name):
    with sync_playwright() as p:
        browser = p.chromium.launch()
        page = browser.new_page(viewport={'width': 1920, 'height': 1080})
        page.goto(url)

        # Esperar carga real del dashboard
        page.wait_for_load_state("networkidle")
        time.sleep(10)

        # Eliminar overlays / popups
        page.evaluate("""
        document.querySelectorAll('.goog-fixedpanel, .modal-dialog, iframe[src*="accounts.google"]').forEach(el => el.remove());
        """)

        # ðŸ”¥ BUSCAR EL CONTENEDOR NEGRO REAL DEL DASHBOARD
        element = page.locator("div[data-testid='report-viewer'], div.report-viewer-container").first

        # Si Looker cambia clases, fallback: buscar el bloque negro por estilo
        if element.count() == 0:
            element = page.locator("div").filter(has_text="OVERVIEW GENERAL").first

        # Screenshot SOLO del dashboard negro
        element.screenshot(path=name)

        browser.close()

capture("https://lookerstudio.google.com/u/1/reporting/d2c2a5e0-dcfe-4633-b141-d4d0179fcae4/page/p_h4ubm1dzyd", "dashboard1.png")
capture("https://lookerstudio.google.com/u/1/reporting/d2c2a5e0-dcfe-4633-b141-d4d0179fcae4/page/p_l9do7lezyd", "dashboard2.png")
